import boto3
import pandas as pd

# Config
excel_file = 'log_groups.xlsx'
sheet_name = 'Sheet1'
region = 'us-east-1'

# Initialize boto3
client = boto3.client('logs', region_name=region)

# Load Excel
df = pd.read_excel(excel_file, sheet_name=sheet_name, engine='openpyxl')

# Clean and extract log group names
log_groups = df.iloc[:, 0].dropna().astype(str).str.strip().tolist()
log_groups = [lg for lg in log_groups if lg.lower() != "loggroup" and lg != ""]

# Log existing log groups for reference
print("üìã Existing log groups in region", region)
existing_groups = client.describe_log_groups()['logGroups']
existing_names = [g['logGroupName'] for g in existing_groups]
for name in existing_names:
    print("-", name)

# Proceed to deletion
print("\nüöÆ Starting deletion process")
for log_group in log_groups:
    if log_group in existing_names:
        try:
            client.delete_log_group(logGroupName=log_group)
            print(f"‚úÖ Deleted: {log_group}")
        except Exception as e:
            print(f"‚ùå Error deleting {log_group}: {e}")
    else:
        print(f"‚ö†Ô∏è Not found or region mismatch: {log_group}")

# Final check
print("\nüìã Remaining log groups:")
remaining_groups = client.describe_log_groups()['logGroups']
for g in remaining_groups:
    print("-", g['logGroupName'])